<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Frontend App (React)</title>
  
  <!-- 1. Load Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- 2. Load Google Font (‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô app.jsx) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai+Looped:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <!-- 3. Load React & ReactDOM Libraries -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  
  <!-- 4. Load Babel (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏õ‡∏•‡∏á JSX ‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    /* 5. Apply a fallback font */
    body {
      font-family: 'Noto Sans Thai Looped', sans-serif;
    }
  </style>
</head>
<body class="bg-[#F8F9FA]">
  
  <!-- 6. ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà React ‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ render ‡πÅ‡∏≠‡∏õ -->
  <div id="root"></div>

  <!-- 7. ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡πÇ‡∏Ñ‡πâ‡∏î React (app.jsx) ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì -->
  <script type="text/babel">
    
    // --- Setup: ‡∏î‡∏∂‡∏á Hooks ‡∏à‡∏≤‡∏Å Global React Object ---
    // ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà 'import React, { ... } from 'react';'
    const { useState, useEffect, useMemo, useCallback, createContext, useContext } = React;
    
    // --- Start: ‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏≤‡∏Å app.jsx ---

    // --- ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà (Constants) ---
    const APP_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwH_v5bgYKDs-uAusVYbPaoahTemJPMCZuiS582EEa9rkiYR1UMsnAShjGl6y-w228/exec';
    const ITEMS_PER_PAGE = 20;
    const CATEGORIES = [
        '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏á‡∏≤‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', 
        '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏° ‡∏™‡∏±‡∏°‡∏°‡∏ô‡∏≤', 
        '‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏π', 
        '‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', 
        '‡∏Å‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏ä‡∏∏‡∏°‡∏ä‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≤‡∏á ‡πÜ'
    ];
    const MAX_IMAGE_SIZE = 1200; // 1200px

    // --- ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô (Icons) ---
    const IconHome = () => (
      <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6-4a1 1 0 001-1v-1a1 1 0 10-2 0v1a1 1 0 001 1z" />
      </svg>
    );

    const IconAdmin = () => (
      <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
      </svg>
    );

    const IconLoading = () => (
      <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-current" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
    );

    const IconEdit = () => (
      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z" />
      </svg>
    );

    const IconDelete = () => (
      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
      </svg>
    );

    const IconLink = () => (
      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.102 1.101" />
      </svg>
    );

    // ADDED: ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
    const IconInfo = () => (
      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    );

    // --- START EDIT: Add Icon ---
    const IconExternalLink = () => (
      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
      </svg>
    );
    // --- END EDIT ---

    // --- START EDIT: Add Icon ---
    const IconChevronDown = () => (
      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
      </svg>
    );
    // --- END EDIT ---


    // --- ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Modal ---
    const IconCheckCircle = () => (
      <svg className="w-12 h-12 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    );

    const IconExclamationTriangle = () => (
      <svg className="w-12 h-12 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
      </svg>
    );

    const IconXCircle = () => (
      <svg className="w-12 h-12 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    );

    const IconSpinner = () => ( // A different loading icon for the modal
      <svg className="animate-spin h-10 w-10 text-[#A2E4B8]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
    );


    // --- Modal System ---
    const ModalContext = React.createContext();

    const ModalProvider = ({ children }) => {
      const [modal, setModal] = useState(null); // null or { type, title, text, html, onConfirm, onCancel }

      // --- START EDIT: Stabilize Context Value ---
      // Wrap all functions in useCallback to stabilize their references
      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà re-render
      const show = useCallback((config) => {
        setModal({
          type: config.icon || 'info', // 'success', 'error', 'warning', 'info'
          title: config.title || '',
          text: config.text || '',
          html: config.html || '', // <-- ADDED: Support for HTML content
          isDetails: config.isDetails || false, // <-- ADDED
          dataItem: config.dataItem || null, // <-- ADDED: To pass the whole item
          onConfirm: () => {
            setModal(null);
            if (config.onConfirm) config.onConfirm();
          },
          showConfirmButton: config.showConfirmButton !== false, // default true
          confirmButtonText: config.confirmButtonText || '‡∏ï‡∏Å‡∏•‡∏á',
          confirmButtonColor: config.confirmButtonColor || '#A2E4B8',
          showCancelButton: false,
          timer: config.timer,
        });
      }, []); // Dependency array is empty

      const confirm = useCallback((config) => {
        setModal({
          type: config.icon || 'warning',
          title: config.title,
          text: config.text,
          html: config.html || '', // <-- ADDED
          isDetails: config.isDetails || false, // <-- ADDED
          dataItem: config.dataItem || null, // <-- ADDED: To pass the whole item
          onConfirm: () => {
            setModal(null);
            if (config.onConfirm) config.onConfirm();
          },
          showConfirmButton: true,
          confirmButtonText: config.confirmButtonText || '‡∏ï‡∏Å‡∏•‡∏á',
          confirmButtonColor: config.confirmButtonColor || '#B22222',
          onCancel: () => {
            setModal(null);
            if (config.onCancel) config.onCancel();
          },
          showCancelButton: true,
          cancelButtonText: config.cancelButtonText || '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
          cancelButtonColor: config.cancelButtonColor || '#6C757D',
        });
      }, []); // Dependency array is empty

      const loading = useCallback((config) => {
        setModal({
          type: 'loading',
          title: config.title,
          text: config.text || '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...',
          allowOutsideClick: config.allowOutsideClick === true, // default false
        });
      }, []); // Dependency array is empty

      const hide = useCallback(() => {
        setModal(null);
      }, []); // Dependency array is empty

      // Memoize the context value object itself
      // contextValue ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà *‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠* ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô (show, confirm, ...) ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
      // (‡∏ã‡∏∂‡πà‡∏á‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ useCallback)
      const contextValue = useMemo(() => ({
        show,
        confirm,
        loading,
        hide
      }), [show, confirm, loading, hide]);
      // --- END EDIT ---
      
      // Handle timed modal
      useEffect(() => {
        if (modal && modal.timer) {
          const timerId = setTimeout(() => {
            setModal(null);
          }, modal.timer);
          return () => clearTimeout(timerId);
        }
      }, [modal]);


      return (
        // --- START EDIT ---
        // Use the memoized contextValue
        <ModalContext.Provider value={contextValue}>
        {/* --- END EDIT --- */}
          {children}
          {modal && <ModalRenderer modal={modal} />}
        </ModalContext.Provider>
      );
    };

    const useModal = () => React.useContext(ModalContext);

    const ModalRenderer = ({ modal }) => {
      const { type, title, text, html, onConfirm, onCancel, showConfirmButton, confirmButtonText, confirmButtonColor, showCancelButton, cancelButtonText, cancelButtonColor, allowOutsideClick, isDetails, dataItem } = modal; // <-- ADDED html, isDetails, dataItem

      const handleOverlayClick = () => {
        if (allowOutsideClick) {
          if (onCancel) onCancel(); else onConfirm();
        }
      };
      
      const getIcon = () => {
        switch (type) {
          case 'success':
            return <IconCheckCircle />;
          case 'error':
            return <IconXCircle />;
          case 'warning':
            return <IconExclamationTriangle />;
          case 'loading':
            return <IconSpinner />;
          default:
            return null;
        }
      };

      return (
        <div 
          className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
          onClick={handleOverlayClick}
        >
          <div 
            className={`bg-white rounded-lg shadow-xl w-full ${isDetails ? 'max-w-2xl' : 'max-w-md'} p-6 m-4`}
            onClick={(e) => e.stopPropagation()} // Prevent click from bubbling to overlay
          >
            <div className="flex flex-col items-center text-center">
              {getIcon()}
              <h3 className="text-xl font-bold text-[#212529] mt-4 mb-2">{title}</h3>
              
              {/* --- START EDIT: Render DetailsView component or simple text/html --- */}
              
              {/* Render DetailsView IF dataItem AND isDetails are provided */}
              {dataItem && isDetails ? (
                <DetailsView item={dataItem} />
              ) : (
                <>
                  {/* Render simple text (for alerts) */}
                  {text && <p className="text-sm text-[#6C757D] mb-6">{text}</p>}

                  {/* Render simple HTML (for alerts, if needed) */}
                  {html && (
                    isDetails ? (
                      // --- START EDIT: "Premium" Details Box ---
                      <div 
                        className="text-sm text-[#212529] text-left break-words max-h-[70vh] overflow-y-auto p-4 bg-[#F8F9FA] border border-[#E9ECEF] rounded-md my-4 w-full"
                        dangerouslySetInnerHTML={{ __html: html }}
                      />
                      // --- END EDIT ---
                    ) : (
                      // Original style for short alerts
                      <div 
                        className="text-sm text-[#6C757D] mb-6 text-left break-words max-h-60 overflow-y-auto" // Set max height and scroll
                        dangerouslySetInnerHTML={{ __html: html }}
                      />
                    )
                  )}
                </>
              )}
              {/* --- END EDIT --- */}
              
              <div className="flex items-center justify-center space-x-4 w-full">
                {showCancelButton && (
                  <button
                    onClick={onCancel}
                    style={{ backgroundColor: cancelButtonColor || '#6C757D', color: '#FFFFFF' }}
                    className="py-2 px-4 rounded-md shadow-sm text-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#6C757D] opacity-90 hover:opacity-100"
                  >
                    {cancelButtonText}
                  </button>
                )}
                {showConfirmButton && (
                   <button
                    onClick={onConfirm}
                    style={{ backgroundColor: confirmButtonColor, color: (confirmButtonColor === '#A2E4B8' ? '#212529' : '#FFFFFF') }}
                    className="py-2 px-4 rounded-md shadow-sm text-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#A2E4B8]"
                  >
                    {confirmButtonText}
                  </button>
                )}
              </div>
            </div>
          </div>
        </div>
      );
    };


    // --- Helper Functions ---

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏Ç‡∏≠‡∏á Google Apps Script
     * @param {string} action - 'login', 'read', 'create', 'update', 'delete'
     * @param {object} data - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏õ (the actual data payload)
     * @param {object} modal - The modal context object
     * @returns {Promise<any>} - ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å API
     */
    const apiCall = async (action, data = {}, modal) => { // <-- CHANGED SIGNATURE
      try {
        const response = await fetch(APP_SCRIPT_URL, {
          method: 'POST',
          redirect: "follow",
          headers: {
            'Content-Type': 'text/plain;charset=utf-8', // ‡πÉ‡∏ä‡πâ text/plain ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Apps Script doPost(e) ‡∏£‡∏±‡∏ö e.postData.contents ‡πÄ‡∏õ‡πá‡∏ô String
          },
          body: JSON.stringify({ action, ...data }) // <-- CHANGED: Send only action and data
        });
        
        // Apps Script ‡∏à‡∏∞ tr·∫£ v·ªÅ JSON string
        const resultText = await response.text();
        return JSON.parse(resultText);

      } catch (error) {
        console.error('API Call Error:', error);
        // Use modal if available, otherwise fallback (though it won't be visible)
        const errorMsg = `‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ: ${error.message}`;
        if(modal) { // <-- modal is now a direct argument
          modal.show({
            icon: 'error',
            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
            text: errorMsg,
          });
        } else {
          console.error('Modal context not available in apiCall for error:', errorMsg);
        }
        return { status: 'error', message: error.message };
      }
    };

    /**
     * ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
     * @param {string} dateString - ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (e.g., "2025-01-01")
     * @returns {string} - e.g., "1 ‡∏°.‡∏Ñ. 2568"
     */
    const formatThaiDate = (dateString) => {
      if (!dateString) return '';
      try {
        const date = new Date(dateString);
        // (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç) ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏ timeZone: 'UTC' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ Timezone ‡∏Ç‡∏≠‡∏á‡∏ö‡∏£‡∏≤‡∏ß‡πÄ‡∏ã‡∏≠‡∏£‡πå
        // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô YYYY-MM-DD) ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ
        return date.toLocaleDateString('th-TH', {
          day: 'numeric',
          month: 'short',
          year: 'numeric',
          timeZone: 'UTC' 
        });
      } catch (e) {
        return dateString; // Fallback
      }
    };

    /**
     * ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 5 ‡∏õ‡∏µ
     * @returns {number[]} - e.g., [2568, 2567, 2566, 2565, 2564, 2563]
     */
    const getFiscalYears = () => {
      const currentMonth = new Date().getMonth(); // 0-11
      // ‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÑ‡∏ó‡∏¢‡πÄ‡∏£‡∏¥‡πà‡∏° 1 ‡∏ï.‡∏Ñ. (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô 9)
      let currentFiscalYear = new Date().getFullYear() + 543;
      if (currentMonth >= 9) { // 9 = ‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°
        currentFiscalYear += 1;
      }
      
      return Array.from({ length: 6 }, (_, i) => currentFiscalYear - i);
    };

    /**
     * ‡∏¢‡πà‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Canvas
     * @param {string} base64Src - Base64 string ‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö
     * @returns {Promise<string>} - Base64 string ‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏¢‡πà‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡πâ‡∏ß (JPEG)
     */
    const resizeImage = (base64Src) => {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.src = base64Src;
        img.onload = () => {
          let width = img.width;
          let height = img.height;

          if (width > height) {
            if (width > MAX_IMAGE_SIZE) {
              height *= MAX_IMAGE_SIZE / width;
              width = MAX_IMAGE_SIZE;
            }
          } else {
            if (height > MAX_IMAGE_SIZE) {
              width *= MAX_IMAGE_SIZE / height;
              height = MAX_IMAGE_SIZE;
            }
          }

          const canvas = document.createElement('canvas');
          canvas.width = width;
          canvas.height = height;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0, width, height);
          
          // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô JPEG ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå (‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û 85%)
          resolve(canvas.toDataURL('image/jpeg', 0.85));
        };
        img.onerror = (error) => {
          console.error("Image load error:", error);
          reject(error);
        };
      });
    };

    /**
     * ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏õ‡πá‡∏ô Base64
     * @param {File} file - ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á
     * @returns {Promise<string>} - Base64 string
     */
    const fileToBase64 = (file) => {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = (error) => reject(error);
      });
    };

    // Create clickable link from text
    const formatDetails = (text) => {
      if (!text) return '';
      const urlRegex = /(https?:\/\/[^\s]+)/g; // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç regex
      return text.replace(urlRegex, (url) => 
        `<a href="${url}" target="_blank" rel="noopener noreferrer" class="text-blue-500 hover:underline">${url}</a>`
      ).replace(/\n/g, '<br />'); // CHANGED: Also replace newlines with <br> for better formatting
    };


    // --- Components ---

    /**
     * (NEW) Details View Component
     * (This component renders the professional-looking details layout inside the modal)
     */
    const DetailsView = ({ item }) => {
      return (
        <div className="text-left w-full max-h-[70vh] overflow-y-auto space-y-5 pr-2">
          
          {/* 1. Title */}
          <h3 className="text-xl font-bold text-[#00796B] mb-3">{item.Title}</h3>

          {/* 2. Year & Date */}
          <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              {/* --- START EDIT --- */}
              <h4 className="text-sm font-bold text-[#00796B] mb-1">‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏û.‡∏®.</h4>
              {/* --- END EDIT --- */}
              <p className="text-base text-[#212529]">{item.FiscalYear}</p>
            </div>
            <div>
              {/* --- START EDIT --- */}
              <h4 className="text-sm font-bold text-[#00796B] mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h4>
              {/* --- END EDIT --- */}
              <p className="text-base text-[#212529]">
                {formatThaiDate(item.DateStart)}
                {item.DateEnd && ` - ${formatThaiDate(item.DateEnd)}`}
              </p>
            </div>
          </div>

          {/* 3. Details */}
          <div>
            {/* --- START EDIT --- */}
            <h4 className="text-sm font-bold text-[#00796B] mb-1">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°)</h4>
            {/* --- END EDIT --- */}
            {item.Details ? (
              <div 
                className="text-base text-[#212529] prose prose-sm max-w-none" 
                dangerouslySetInnerHTML={{ __html: formatDetails(item.Details) }}
              />
            ) : (
              <p className="text-base text-[#6C757D] italic">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</p>
            )}
          </div>

          {/* 4. Images */}
          <div>
            {/* --- START EDIT --- */}
            <h4 className="text-sm font-bold text-[#00796B] mb-2">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h4>
            {/* --- END EDIT --- */}
            <ImageGallery imageIds={[item.Image1_ID, item.Image2_ID, item.Image3_ID, item.Image4_ID]} />
          </div>

          {/* 5. Document Link */}
          <div>
            {/* --- START EDIT --- */}
            <h4 className="text-sm font-bold text-[#00796B] mb-2">‡∏•‡∏¥‡∏á‡∏Ñ‡πå‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á</h4>
            {/* --- END EDIT --- */}
            {item.DocumentFolderURL ? (
              <a
                href={item.DocumentFolderURL}
                target="_blank"
                rel="noopener noreferrer"
                className="inline-flex items-center space-x-2 text-sm text-[#00796B] hover:underline bg-[#F0FBF4] px-3 py-2 rounded-md"
              >
                <IconLink />
                <span>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</span>
              </a>
            ) : (
              <p className="text-base text-[#6C757D] italic">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö</p>
            )}
          </div>
        </div>
      );
    };


    /**
     * Header Component
     */
    const Header = ({ page, onNav }) => (
      <header className="bg-white shadow-md sticky top-0 z-10 font-['Noto_Sans_Thai_Looped',_sans-serif]">
        <div className="container mx-auto px-4 py-3 flex justify-between items-center">
          {/* --- START EDIT: New Logo Left --- */}
          <div className="text-xl md:text-2xl font-bold text-[#00796B]">
            EduLog
          </div>
          {/* --- END EDIT --- */}
          <nav>
            {/* --- START EDIT: New Right-side group (Text + Icon) --- */}
            <div className="flex items-center gap-3 md:gap-4">
              {/* <span className="text-xs sm:text-sm font-medium text-gray-600 hidden sm:block">
                EduLog System
              </span> */} {/* <-- REMOVED THIS LINE */}
              {page === 'admin' && (
                <button
                  onClick={() => onNav('home')}
                  className="text-[#6C757D] hover:text-[#A2E4B8] transition duration-150"
                  title="‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å"
                >
                  <IconHome />
                </button>
              )}
              {page === 'home' && (
                <button
                  onClick={() => onNav('login')}
                  className="text-[#6C757D] hover:text-[#A2E4B8] transition duration-150"
                  title="‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö"
                >
                  <IconAdmin />
                </button>
              )}
            </div>
            {/* --- END EDIT --- */}
          </nav>
        </div>
      </header>
    );

    /**
     * Footer Component
     */
    const Footer = () => (
      <footer className="bg-white border-t border-[#E9ECEF] mt-12 py-6 text-center text-xs text-[#6C757D] font-['Noto_Sans_Thai_Looped',_sans-serif]">
        <p>¬© 2025 EduLog System - V.5.1</p>
        <p className="mt-1">
          Powered by: Gemini AI (Initial Code Generation)
          <br />
          Implemented & Authored by: ‡∏ô‡∏≤‡∏¢‡∏û‡∏¥‡∏ó‡∏±‡∏Å‡∏©‡πå‡∏ä‡∏±‡∏¢ ‡∏ú‡∏≤‡∏¢‡∏ö‡∏∂‡∏á‡πÅ‡∏Å‡πâ‡∏ß
        </p>
      </footer>
    );

    /**
     * Login Page Component
     */
    const LoginPage = ({ onLoginSuccess }) => {
      const [password, setPassword] = useState('');
      const [isLoading, setIsLoading] = useState(false);
      const modal = useModal(); // Get modal context

      const handleSubmit = async (e) => {
        e.preventDefault();
        setIsLoading(true);
        
        const result = await apiCall('login', { password }, modal); // Pass modal // <-- CHANGED

        setIsLoading(false);
        if (result.status === 'success') {
          onLoginSuccess();
        } else {
          modal.show({
            icon: 'error',
            title: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
            text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
            confirmButtonColor: '#A2E4B8',
          });
          setPassword('');
        }
      };

      return (
        <div className="flex items-center justify-center py-12 px-4">
          <div className="w-full max-w-md p-8 space-y-6 bg-white rounded-lg shadow-lg">
            <h2 className="text-2xl font-bold text-center text-[#212529]">
              üîí ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö
            </h2>
            <form className="space-y-6" onSubmit={handleSubmit}>
              <div>
                <label
                  htmlFor="password"
                  className="block text-sm font-medium text-[#6C757D]"
                >
                  ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
                </label>
                <input
                  id="password"
                  name="password"
                  type="password"
                  autoComplete="current-password"
                  required
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className="mt-1 block w-full px-3 py-2 border border-[#E9ECEF] rounded-md shadow-sm placeholder-[#6C757D] focus:outline-none focus:ring-[#A2E4B8] focus:border-[#A2E4B8]"
                  placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"
                />
              </div>
              <button
                type="submit"
                disabled={isLoading}
                className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-[#212529] bg-[#A2E4B8] hover:bg-opacity-80 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#A2E4B8] disabled:opacity-50 disabled:cursor-not-allowed transition duration-150"
              >
                {isLoading && <IconLoading />}
                {isLoading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...' : '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö'}
              </button>
            </form>
          </div>
        </div>
      );
    };

    /**
     * Data Form Component
     */
    const DataForm = ({ onFormSubmit, initialData, onCancel }) => {
      const isEditMode = !!initialData;
      
      // State for form fields
      const [type, setType] = useState(initialData?.Type || CATEGORIES[0]);
      const [fiscalYear, setFiscalYear] = useState(initialData?.FiscalYear || getFiscalYears()[0]);
      const [title, setTitle] = useState(initialData?.Title || '');
      const [dateStart, setDateStart] = useState(initialData?.DateStart || '');
      const [dateEnd, setDateEnd] = useState(initialData?.DateEnd || '');
      const [details, setDetails] = useState(initialData?.Details || '');
      
      // State for file uploads
      const [images, setImages] = useState([]); // Array of File objects
      const [imagePreviews, setImagePreviews] = useState([]); // <-- ADDED: State for preview URLs
      const [documents, setDocuments] = useState([]); // Array of File objects
      
      // State for loading
      const [isSubmitting, setIsSubmitting] = useState(false);
      const modal = useModal(); // Get modal context

      // ADDED: useEffect for cleaning up image preview URLs
      useEffect(() => {
        // Cleanup function to revoke object URLs and prevent memory leaks
        return () => {
          imagePreviews.forEach(url => URL.revokeObjectURL(url));
        };
      }, [imagePreviews]); // Dependency: run this when imagePreviews array itself is replaced

      // File handling
      const handleImageChange = (e) => {
        const files = Array.from(e.target.files); // <-- ADDED: Get files
        if (files.length > 4) { // <-- CHANGED: Use files.length
          modal.show({
            title: '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 
            text: '‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 4 ‡∏†‡∏≤‡∏û‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 
            icon: 'warning'
          });
          setImages([]);
          setImagePreviews([]); // <-- ADDED: Clear previews
          e.target.value = null; // Clear file input
        } else {
          setImages(files); // <-- CHANGED: Use files
          // ADDED: Create and set previews
          const newPreviews = files.map(file => URL.createObjectURL(file));
          setImagePreviews(newPreviews);
        }
      };

      const handleDocumentChange = (e) => {
        setDocuments(Array.from(e.target.files));
      };

      // Form submission
      const handleSubmit = async (e) => {
        e.preventDefault();

        // 1. Validation
        if (!type || !fiscalYear || !title || !dateStart) {
          modal.show({
            title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 
            text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• * ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö', 
            icon: 'warning'
          });
          return;
        }
        
        if (isEditMode && images.length === 0 && !initialData?.Image1_ID) {
           // In edit mode, if no new images are added, we keep the old ones.
           // But if it's CREATE mode and no images, we should warn.
        } else if (!isEditMode && images.length === 0) {
            // We decided that images are not mandatory, but let's check the requirement
            // Re-reading: 1.1.1-1.1.4 are mandatory. Images (1.1.6) are not in this list. So, it's fine.
        }
        
        setIsSubmitting(true);
        modal.loading({
          title: isEditMode ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
          text: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
          allowOutsideClick: false,
        });

        try {
          // 2. Process Files to Base64
          // Process Images with resizing
          const imagePromises = images.map(async (file) => {
            const base64 = await fileToBase64(file);
            const resizedBase64 = await resizeImage(base64);
            return {
              fileName: file.name,
              mimeType: 'image/jpeg', // Force JPEG after resizing
              base64: resizedBase64.split(',')[1], // Remove "data:image/jpeg;base64,"
            };
          });
          
          // Process Documents
          const documentPromises = documents.map(async (file) => {
            const base64 = await fileToBase64(file);
            return {
              fileName: file.name,
              mimeType: file.type,
              base64: base64.split(',')[1], // Remove prefix
            };
          });

          const processedImages = await Promise.all(imagePromises);
          const processedDocuments = await Promise.all(documentPromises);

          // 3. Prepare Payload
          const payload = {
            rowId: initialData?.RowID || null,
            Type: type,
            FiscalYear: fiscalYear,
            Title: title,
            DateStart: dateStart,
            DateEnd: dateEnd,
            Details: details,
            // Send new files. Backend will decide whether to use them or keep old ones.
            images: processedImages,
            documents: processedDocuments,
            // modal, // Pass modal context for apiCall // <-- REMOVED from payload
          };

          // 4. API Call
          const action = isEditMode ? 'update' : 'create';
          const result = await apiCall(action, payload, modal); // <-- CHANGED

          if (result.status === 'success') {
            modal.show({
              icon: 'success',
              title: isEditMode ? '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
              text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
              timer: 2000,
              showConfirmButton: false
            });
            onFormSubmit(result.data); // 'data' should be the updated/new row
            resetForm();
          } else {
            throw new Error(result.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å');
          }

        } catch (error) {
          console.error('Submission Error:', error);
          // CHANGED: Improved error message handling
          let errorMsg = error.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ';
          if (errorMsg.includes('Invalid POST action')) {
            errorMsg = '‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (Invalid Action)';
          } else if (errorMsg.includes('Failed to fetch')) {
            errorMsg = `‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ`;
          } else if (!error.message) {
             errorMsg = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏';
          } else {
            errorMsg = `‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ${error.message}`;
          }
          
          modal.show({
            icon: 'error',
            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
            text: errorMsg, // <-- CHANGED
          });
        } finally {
          setIsSubmitting(false);
        }
      };
      
      const resetForm = () => {
          // Don't reset in edit mode, just call onCancel
          if(isEditMode) {
              onCancel();
              return;
          }
          setType(CATEGORIES[0]);
          setFiscalYear(getFiscalYears()[0]);
          setTitle('');
          setDateStart('');
          setDateEnd('');
          setDetails('');
          setImages([]);
          setImagePreviews([]); // <-- ADDED
          setDocuments([]);
          // Clear file inputs (somewhat tricky, needs a key or ref, but for now this is ok)
          document.getElementById('images').value = null;
          document.getElementById('documents').value = null;
      };


      const fiscalYears = getFiscalYears();

      return (
        <div className="bg-white p-6 rounded-lg shadow-lg">
          <h2 className="text-xl font-bold text-[#212529] mb-4 border-b border-[#E9ECEF] pb-2">
            {isEditMode ? 'üìù ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô' : '‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô'}
          </h2>
          <form onSubmit={handleSubmit} className="space-y-4">
            
            {/* Row 1: Type & Year */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label htmlFor="type" className="block text-sm font-medium text-[#212529]">
                  ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡∏ô‡πÄ‡∏≠‡∏á <span className="text-red-500">*</span>
                </label>
                <select
                  id="type"
                  value={type}
                  onChange={(e) => setType(e.target.value)}
                  required
                  className="mt-1 block w-full px-3 py-2 border border-[#E9ECEF] rounded-md shadow-sm focus:outline-none focus:ring-[#A2E4B8] focus:border-[#A2E4B8] bg-white"
                >
                  {CATEGORIES.map((cat) => (
                    <option key={cat} value={cat}>{cat}</option>
                  ))}
                </select>
              </div>
              <div>
                <label htmlFor="fiscalYear" className="block text-sm font-medium text-[#212529]">
                  ‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏û.‡∏®. <span className="text-red-500">*</span>
                </label>
                <select
                  id="fiscalYear"
                  value={fiscalYear}
                  onChange={(e) => setFiscalYear(e.target.value)}
                  required
                  className="mt-1 block w-full px-3 py-2 border border-[#E9ECEF] rounded-md shadow-sm focus:outline-none focus:ring-[#A2E4B8] focus:border-[#A2E4B8] bg-white"
                >
                  {fiscalYears.map((year) => (
                    <option key={year} value={year}>{year}</option>
                  ))}
                </select>
              </div>
            </div>

            {/* Row 2: Title */}
            <div>
              <label htmlFor="title" className="block text-sm font-medium text-[#212529]">
                ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                id="title"
                value={title}
                onChange={(e) => setTitle(e.target.value)}
                required
                className="mt-1 block w-full px-3 py-2 border border-[#E9ECEF] rounded-md shadow-sm focus:outline-none focus:ring-[#A2E4B8] focus:border-[#A2E4B8]"
              />
            </div>

            {/* Row 3: Dates */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label htmlFor="dateStart" className="block text-sm font-medium text-[#212529]">
                  ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô) <span className="text-red-500">*</span>
                </label>
                <input
                  type="date"
                  id="dateStart"
                  value={dateStart}
                  onChange={(e) => setDateStart(e.target.value)}
                  required
                  className="mt-1 block w-full px-3 py-2 border border-[#E9ECEF] rounded-md shadow-sm focus:outline-none focus:ring-[#A2E4B8] focus:border-[#A2E4B8]"
                />
              </div>
              <div>
                <label htmlFor="dateEnd" className="block text-sm font-medium text-[#212529]">
                  ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î) (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                </label>
                <input
                  type="date"
                  id="dateEnd"
                  value={dateEnd}
                  onChange={(e) => setDateEnd(e.target.value)}
                  className="mt-1 block w-full px-3 py-2 border border-[#E9ECEF] rounded-md shadow-sm focus:outline-none focus:ring-[#A2E4B8] focus:border-[#A2E4B8]"
                />
              </div>
            </div>

            {/* Row 4: Details */}
            <div>
              <label htmlFor="details" className="block text-sm font-medium text-[#212529]">
                ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°)
              </label>
              <textarea
                id="details"
                rows="4"
                value={details}
                onChange={(e) => setDetails(e.target.value)}
                className="mt-1 block w-full px-3 py-2 border border-[#E9ECEF] rounded-md shadow-sm focus:outline-none focus:ring-[#A2E4B8] focus:border-[#A2E4B8]"
                placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°... ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏ö‡∏•‡∏¥‡∏á‡∏Ñ‡πå ‡∏•‡∏¥‡∏á‡∏Ñ‡πå‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•"
              ></textarea>
            </div>

            {/* Row 5: File Uploads */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label htmlFor="images" className="block text-sm font-medium text-[#212529]">
                  ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 4 ‡∏†‡∏≤‡∏û)
                </label>
                <input
                  type="file"
                  id="images"
                  multiple
                  accept="image/*"
                  onChange={handleImageChange}
                  className="mt-1 block w-full text-sm text-[#6C757D] file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-[#F0FBF4] file:text-[#212529] hover:file:bg-[#A2E4B8]"
                />
                {/* --- START EDIT --- */}
                {/* Logic to show existing images OR new image count */}
                {images.length > 0 ? (
                  <p className="text-xs text-[#6C757D] mt-1">
                    {`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ${images.length} ‡∏†‡∏≤‡∏û`}
                  </p>
                ) : isEditMode && (initialData.Image1_ID || initialData.Image2_ID || initialData.Image3_ID || initialData.Image4_ID) ? (
                  <div className="mt-2 p-2 border border-[#E9ECEF] rounded-md bg-[#F8F9FA]">
                    <h4 className="text-xs font-semibold text-[#6C757D] mb-2">‡∏†‡∏≤‡∏û‡πÄ‡∏î‡∏¥‡∏° (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏±‡∏ö‡∏ó‡∏µ‡πà):</h4>
                    <div className="grid grid-cols-4 gap-2">
                      {[initialData.Image1_ID, initialData.Image2_ID, initialData.Image3_ID, initialData.Image4_ID]
                        .filter(id => id) // Filter out empty IDs
                        .map((id, index) => (
                          <div key={id} className="aspect-square rounded-md overflow-hidden shadow-sm">
                            <img
                              src={`https://drive.google.com/thumbnail?id=${id}`}
                              alt={`‡∏†‡∏≤‡∏û‡πÄ‡∏î‡∏¥‡∏° ${index + 1}`}
                              className="w-full h-full object-cover"
                               onError={(e) => {
                                 e.target.src = `https://placehold.co/100x100/E9ECEF/6C757D?text=Img+${index + 1}`;
                               }}
                            />
                          </div>
                        ))
                      }
                    </div>
                  </div>
                ) : (
                  <p className="text-xs text-[#6C757D] mt-1">
                    ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û
                  </p>
                )}
                {/* --- END EDIT --- */}
                
                {/* ADDED: Image Preview Section */}
                {imagePreviews.length > 0 && (
                  <div className="mt-2 grid grid-cols-4 gap-2 p-2 border border-[#E9ECEF] rounded-md bg-[#F8F9FA]">
                    {imagePreviews.map((url, index) => (
                      <div key={index} className="aspect-square rounded-md overflow-hidden shadow-sm">
                        <img
                          src={url}
                          alt={`‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà ${index + 1}`}
                          className="w-full h-full object-cover"
                        />
                      </div>
                    ))}
                  </div>
                )}
              </div>
              <div>
                <label htmlFor="documents" className="block text-sm font-medium text-[#212529]">
                  ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ)
                </label>
                {/* --- START EDIT --- */}
                <input
                  type="file"
                  id="documents"
                  multiple
                  onChange={handleDocumentChange}
                  accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt" // <-- ADDED: Accept only document types
                  className="mt-1 block w-full text-sm text-[#6C757D] file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-[#F0FBF4] file:text-[#212529] hover:file:bg-[#A2E4B8]"
                />
                {/* --- END EDIT --- */}
                {/* --- START EDIT --- */}
                {/* Logic to show existing document link OR new file count */}
                {documents.length > 0 ? (
                   <p className="text-xs text-[#6C757D] mt-1">
                    {`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ${documents.length} ‡πÑ‡∏ü‡∏•‡πå`}
                   </p>
                ) : isEditMode && initialData?.DocumentFolderURL ? (
                  <div className="mt-2 p-3 border border-[#E9ECEF] rounded-md bg-[#F8F9FA]">
                    <h4 className="text-xs font-semibold text-[#6C757D] mb-2">‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏° (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏±‡∏ö‡∏ó‡∏µ‡πà):</h4>
                    <a
                      href={initialData.DocumentFolderURL}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="flex items-center text-sm text-[#00796B] hover:underline truncate"
                      title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°"
                    >
                      <IconLink />
                      <span className="ml-2 truncate">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°</span>
                    </a>
                  </div>
                ) : (
                  <p className="text-xs text-[#6C757D] mt-1">
                    ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
                  </p>
                )}
                {/* --- END EDIT --- */}
                {/* --- START EDIT --- */}
                {/* ADDED: Document Filename List */}
                {documents.length > 0 && (
                  <div className="mt-2 p-3 border border-[#E9ECEF] rounded-md bg-[#F8F9FA]">
                    <h4 className="text-xs font-semibold text-[#6C757D] mb-2">‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</h4>
                    <ul className="space-y-1">
                      {documents.map((file, index) => (
                        <li key={index} className="flex items-center text-sm text-[#212529] truncate" title={file.name}>
                          <IconLink /> {/* Using existing icon */}
                          <span className="ml-2">{file.name}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                )}
                {/* --- END EDIT --- */}
              </div>
            </div>

            {/* Row 6: Actions */}
            <div className="flex items-center justify-end space-x-3 pt-4 border-t border-[#E9ECEF]">
               {isEditMode && (
                 <button
                    type="button"
                    onClick={onCancel}
                    disabled={isSubmitting}
                    className="py-2 px-4 border border-[#E9ECEF] rounded-md shadow-sm text-sm font-medium text-[#212529] bg-white hover:bg-[#F8F9FA] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#A2E4B8] transition duration-150"
                 >
                    ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                 </button>
               )}
              <button
                type="submit"
                disabled={isSubmitting}
                className="inline-flex justify-center py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-bold text-[#212529] bg-[#A2E4B8] hover:bg-opacity-80 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#A2E4B8] disabled:opacity-50 disabled:cursor-not-allowed transition duration-150"
              >
                {isSubmitting && <IconLoading />}
                {isSubmitting ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : (isEditMode ? '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•')}
              </button>
            </div>
          </form>
        </div>
      );
    };

    /**
     * Image Gallery Component
     */
    const ImageGallery = ({ imageIds = [] }) => {
      if (imageIds.filter(id => id).length === 0) {
        return <p className="text-sm text-[#6C757D] text-center py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</p>;
      }
      
      // --- START EDIT ---
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á URL ‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö href (‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π) ‡πÅ‡∏•‡∏∞ src (‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•)
      // Google Drive ‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå /uc (User Content) ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÉ‡∏ô <img>
      // ‡πÄ‡∏£‡∏≤‡∏à‡∏∂‡∏á‡πÉ‡∏ä‡πâ /thumbnail ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö <img> ‡πÅ‡∏•‡∏∞ /file/d/.../view ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö <a>
      const imageLinks = imageIds
        .filter(id => id) // ‡∏Å‡∏£‡∏≠‡∏á ID ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
        .map(id => ({
          href: `https://drive.google.com/file/d/${id}/view?usp=sharing`, // ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå
          src: `https://drive.google.com/thumbnail?id=${id}` // ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û thumbnail
        }));
      // --- END EDIT ---

      return (
        <div className="grid grid-cols-2 md:grid-cols-4 gap-2 p-4 bg-[#F8F9FA] rounded-md">
          {/* --- START EDIT --- */}
          {imageLinks.map((link, index) => (
            <a
              key={index}
              href={link.href} // <-- CHANGED
              target="_blank"
              rel="noopener noreferrer"
              className="block rounded-lg overflow-hidden shadow-md aspect-square"
            >
              <img
                src={link.src} // <-- CHANGED
                alt={`‡∏†‡∏≤‡∏û‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° ${index + 1}`}
                className="w-full h-full object-cover transition-transform duration-300 hover:scale-105"
                // Fallback ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏£‡∏π‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
                onError={(e) => {
                  e.target.src = `https://placehold.co/400x400/E9ECEF/6C757D?text=Image+${index + 1}`;
                  e.target.alt = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ";
                }}
              />
            </a>
          ))}
          {/* --- END EDIT --- */}
        </div>
      );
    };

    /**
     * Pagination Component
     */
    const Pagination = ({ currentPage, totalPages, onPageChange }) => {
      if (totalPages <= 1) return null;

      const pages = Array.from({ length: totalPages }, (_, i) => i + 1);

      return (
        <nav className="flex justify-center items-center space-x-2 mt-4">
          <button
            onClick={() => onPageChange(currentPage - 1)}
            disabled={currentPage === 1}
            className="px-3 py-1 rounded-md text-sm font-medium text-[#6C757D] bg-white border border-[#E9ECEF] hover:bg-[#F8F9FA] disabled:opacity-50"
          >
            ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
          </button>
          {pages.map((page) => (
            <button
              key={page}
              onClick={() => onPageChange(page)}
              className={`px-3 py-1 rounded-md text-sm font-medium border ${
                page === currentPage
                  ? 'bg-[#A2E4B8] text-[#212529] border-[#A2E4B8]'
                  : 'bg-white text-[#6C757D] border-[#E9ECEF] hover:bg-[#F8F9FA]'
              }`}
            >
              {page}
            </button>
          ))}
          <button
            onClick={() => onPageChange(currentPage + 1)}
            disabled={currentPage === totalPages}
            className="px-3 py-1 rounded-md text-sm font-medium text-[#6C757D] bg-white border border-[#E9ECEF] hover:bg-[#F8F9FA] disabled:opacity-50"
          >
            ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
          </button>
        </nav>
      );
    };

    /**
     * (NEW) Dashboard Card Component
     */
    const DashboardCard = ({ item, onClick }) => {
      return (
        <button
          onClick={onClick}
          className="group bg-white rounded-lg shadow-lg overflow-hidden transition-all duration-300 hover:shadow-xl hover:-translate-y-1 block text-left w-full"
          title={`‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π: ${item.Title}`}
        >
          {/* Image */}
          {/* --- START EDIT: Change h-40 to h-48 --- */}
          <div className="w-full h-48 bg-gray-200 overflow-hidden relative">
          {/* --- END EDIT --- */}
            <img
              src={`https://drive.google.com/thumbnail?id=${item.Image1_ID}`}
              alt={item.Title}
              className="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
              onError={(e) => {
                e.target.src = `https://placehold.co/400x300/E9ECEF/6C757D?text=Image`;
                e.target.alt = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û";
              }}
            />
             {/* Gradient overlay for better text readability */}
             {/* --- START EDIT: Add transition and group-hover effect --- */}
             <div className="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent transition-all duration-300 group-hover:from-black/70"></div>
             {/* --- END EDIT --- */}
          </div>
          {/* Content */}
          <div className="p-4">
            <p className="text-xs font-medium text-[#00796B] mb-1">
              {formatThaiDate(item.DateStart)}
            </p>
            <h3 
              className="text-sm font-semibold text-[#212529] line-clamp-2 h-10" // h-10 ensures 2 lines height
            >
              {item.Title}
            </h3>
          </div>
        </button>
      );
    };

    /**
     * (NEW) Recent Activity Dashboard Component
     */
    const RecentActivityDashboard = ({ items, modal }) => {
      
      const handleCardClick = (item) => {
        modal.show({
          title: "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô",
          dataItem: item, // Pass the whole item to render DetailsView
          confirmButtonText: '‡∏õ‡∏¥‡∏î',
          confirmButtonColor: '#A2E4B8',
          isDetails: true,
        });
      };

      return (
        <div className="my-8"> {/* Margin top and bottom */}
          {/* --- START EDIT: Style Header --- */}
          <h2 className="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-[#00796B] to-[#004D40] mb-5 pb-2 border-b border-[#E9ECEF]">
            ‚ú® ‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
          </h2>
          {/* --- END EDIT --- */}
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
            {items.map((item) => (
              <DashboardCard 
                key={item.RowID} 
                item={item} 
                onClick={() => handleCardClick(item)} 
              />
            ))}
          </div>
        </div>
      );
    };


    /**
     * Data Table Component
     */
    const DataTable = ({ data, onEdit, onDelete, modal, isPublic = false }) => { // <-- ADDED modal prop & isPublic
      const [filters, setFilters] = useState({ year: '', type: '' });
      const [currentPage, setCurrentPage] = useState(1);
      const [showImageMap, setShowImageMap] = useState({}); // { rowId: boolean }
      const fiscalYears = getFiscalYears();
      
      // 1. Filter Data
      const filteredData = useMemo(() => {
        return data
          .filter(item => {
            const matchYear = filters.year ? item.FiscalYear.toString() === filters.year : true;
            const matchType = filters.type ? item.Type === filters.type : true;
            return matchYear && matchType;
          })
          // 2. Sort Data (‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô, ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°)
          .sort((a, b) => {
            if (b.FiscalYear !== a.FiscalYear) {
              return b.FiscalYear - a.FiscalYear; // ‡∏õ‡∏µ‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢
            }
            // ‡∏ñ‡πâ‡∏≤‡∏õ‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô)
            return new Date(b.DateStart) - new Date(a.DateStart);
          });
      }, [data, filters]);

      // 3. Paginate Data
      const totalPages = Math.ceil(filteredData.length / ITEMS_PER_PAGE);
      const paginatedData = filteredData.slice(
        (currentPage - 1) * ITEMS_PER_PAGE,
        currentPage * ITEMS_PER_PAGE
      );
      
      // Reset page to 1 when filters change
      useEffect(() => {
        setCurrentPage(1);
      }, [filters]);
      
      // Toggle image visibility
      const toggleImages = (rowId) => {
        setShowImageMap(prev => ({ ...prev, [rowId]: !prev[rowId] }));
      };
      
      // Create clickable link from text
      // (MOVED TO GLOBAL)
      // const formatDetails = (text) => { ... };

      return (
        <div className="bg-white p-6 rounded-lg shadow-lg mt-8">
          {/* --- START EDIT --- */}
          <div className="flex flex-wrap sm:flex-nowrap justify-between items-center mb-4 gap-3">
            {/* --- START EDIT: Style Header --- */}
            <h2 className="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-[#00796B] to-[#004D40] whitespace-nowrap">
              ‚ò∞ ‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô
            </h2>
            {/* --- END EDIT --- */}
            {/* Add button ONLY for Admin data table */}
            {!isPublic && (
              <button
                onClick={() => {
                  const dbUrl = "https://docs.google.com/spreadsheets/d/1QBRw1WRMW_WDXoBV59YGOjwLnYV1h4aLXpxMxdoJcds/edit?usp=sharing";
                  
                  // (Tailwind classes won't work in dangerouslySetInnerHTML, must use inline styles)
                  const modalHtml = `
                    <div style="text-align: left; font-family: 'Noto Sans Thai Looped', sans-serif; space-y: 1rem;">
                      <a
                        href="${dbUrl}"
                        target="_blank"
                        rel="noopener noreferrer"
                        style="display: inline-flex; align-items: center; justify-content: center; width: 100%; gap: 0.5rem; padding-top: 0.75rem; padding-bottom: 0.75rem; padding-left: 1.5rem; padding-right: 1.5rem; border: 1px solid transparent; border-radius: 0.375rem; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); font-size: 1.125rem; font-weight: 700; color: #212529; background-color: #A2E4B8; text-decoration: none; transition: background-color 0.15s ease-in-out;"
                        onmouseover="this.style.opacity='0.8'"
                        onmouseout="this.style.opacity='1'"
                      >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="width: 1.25rem; height: 1.25rem;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                        <span>‡πÄ‡∏õ‡∏¥‡∏î Google Sheet</span>
                      </a>
                      <div style="background-color: #F8F9FA; padding: 1.25rem; border-radius: 0.375rem; border: 1px solid #E9ECEF; margin-top: 1.5rem;">
                        <div style="margin-bottom: 1rem;">
                          <h4 style="font-size: 0.875rem; font-weight: 700; color: #00796B; margin-bottom: 0.25rem;">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á:</h4>
                          <p style="font-size: 1rem; color: #212529; word-break: break-word; margin: 0;">g4779pitakchaiph@kurupatana.ac.th</p>
                        </div>
                        <div style="margin-bottom: 1rem;">
                          <h4 style="font-size: 0.875rem; font-weight: 700; color: #00796B; margin-bottom: 0.25rem;">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Sheet):</h4>
                          <p style="font-size: 1rem; color: #212529; word-break: break-word; margin: 0;">/11-App Sheet/‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô/</p>
                        </div>
                        <div>
                          <h4 style="font-size: 0.875rem; font-weight: 700; color: #00796B; margin-bottom: 0.25rem;">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Drive):</h4>
                          <p style="font-size: 1rem; color: #212529; word-break: break-word; margin: 0;">/11-App Sheet/‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô/‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</p>
                        </div>
                      </div>
                    </div>
                  `;
                  
                  modal.show({
                    title: "üìÅ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•",
                    html: modalHtml,
                    isDetails: true, // Use wider modal
                    confirmButtonText: '‡∏õ‡∏¥‡∏î',
                    confirmButtonColor: '#A2E4B8',
                  });
                }}
                className="inline-flex items-center space-x-2 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-[#212529] bg-[#F0FBF4] hover:bg-[#A2E4B8] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#A2E4B8] transition duration-150 flex-shrink-0"
              >
                <IconExternalLink /> 
                <span>‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
              </button>
            )}
          </div>
          {/* --- END EDIT --- */}
          
          {/* Filters */}
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4 p-4 bg-[#F8F9FA] rounded-md">
            <div>
              <label htmlFor="filterYear" className="block text-sm font-medium text-[#6C757D]">
                ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì
              </label>
              <select
                id="filterYear"
                value={filters.year}
                onChange={(e) => setFilters(prev => ({...prev, year: e.target.value}))}
                className="mt-1 block w-full px-3 py-2 border border-[#E9ECEF] rounded-md shadow-sm focus:outline-none focus:ring-[#A2E4B8] focus:border-[#A2E4B8] bg-white"
              >
                <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                {fiscalYears.map((year) => (
                  <option key={year} value={year}>{year}</option>
                ))}
              </select>
            </div>
            <div>
              <label htmlFor="filterType" className="block text-sm font-medium text-[#6C757D]">
                ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
              </label>
              <select
                id="filterType"
                value={filters.type}
                onChange={(e) => setFilters(prev => ({...prev, type: e.target.value}))}
                className="mt-1 block w-full px-3 py-2 border border-[#E9ECEF] rounded-md shadow-sm focus:outline-none focus:ring-[#A2E4B8] focus:border-[#A2E4B8] bg-white"
              >
                <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                {CATEGORIES.map((cat) => (
                  <option key={cat} value={cat}>{cat}</option>
                ))}
              </select>
            </div>
            <div className="self-end">
               <button
                onClick={() => setFilters({ year: '', type: '' })}
                className="w-full md:w-auto mt-1 py-2 px-4 border border-[#E9ECEF] rounded-md shadow-sm text-sm font-medium text-[#212529] bg-white hover:bg-[#F8F9FA] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#A2E4B8] transition duration-150"
              >
                ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
              </button>
            </div>
          </div>

          {/* Table */}
          <div className="overflow-x-auto">
            <table className="min-w-full bg-white">
              <thead className="border-b-2 border-[#DEE2E6]">
                <tr>
                  <th className="px-4 py-3 text-left text-xs font-bold text-[#212529] uppercase tracking-wider">
                    ‡∏õ‡∏µ‡∏á‡∏ö‡∏Ø
                  </th>
                  <th className="px-4 py-3 text-left text-xs font-bold text-[#212529] uppercase tracking-wider">
                    ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
                  </th>
                  <th className="px-4 py-3 text-left text-xs font-bold text-[#212529] uppercase tracking-wider">
                    ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á / ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
                  </th>
                  {/* ADDED COLUMN */}
                  <th className="px-4 py-3 text-left text-xs font-bold text-[#212529] uppercase tracking-wider">
                    ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
                  </th>
                  <th className="px-4 py-3 text-left text-xs font-bold text-[#212529] uppercase tracking-wider">
                    ‡πÑ‡∏ü‡∏•‡πå/‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
                  </th>
                  {/* --- START EDIT: Conditional Columns --- */}
                  {!isPublic && (
                    <th className="px-4 py-3 text-left text-xs font-bold text-[#212529] uppercase tracking-wider">
                      ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
                    </th>
                  )}
                  {isPublic && (
                    <th className="px-4 py-3 text-center text-xs font-bold text-[#212529] uppercase tracking-wider">
                      ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                    </th>
                  )}
                  {/* --- END EDIT --- */}
                </tr>
              </thead>
              <tbody className="divide-y divide-[#E9ECEF]">
                {paginatedData.length === 0 ? (
                  <tr>
                    <td colSpan="6" className="px-4 py-6 text-center text-[#6C757D]">
                      ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </td>
                  </tr>
                ) : (
                  paginatedData.map((item, index) => (
                    <React.Fragment key={item.RowID}>
                      <tr className={index % 2 === 0 ? 'bg-white' : 'bg-[#F0FBF4]'}>
                        <td className="px-4 py-4 whitespace-nowrap text-sm font-medium text-[#212529]">
                          {item.FiscalYear}
                        </td>
                        <td className="px-4 py-4 whitespace-nowTTrAuncate text-sm text-[#212529]">
                          {formatThaiDate(item.DateStart)}
                          {item.DateEnd && ` - ${formatThaiDate(item.DateEnd)}`}
                        </td>
                        <td className="px-4 py-4 max-w-sm">
                          {/* --- START EDIT: Conditionally add info button for Admin --- */}
                          {/* CHANGED: Added flex wrapper and conditional info button */}
                          <div className="flex items-center space-x-2">
                            <span className="text-sm font-semibold text-[#212529] truncate" title={item.Title}>
                              {item.Title}
                            </span>
                            {/* Show details button ONLY for Admin (not public) */}
                            {!isPublic && (
                              <button
                                onClick={() => modal.show({
                                  title: "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: " + item.Title,
                                  html: item.Details ? formatDetails(item.Details) : '<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</p>',
                                  confirmButtonText: '‡∏õ‡∏¥‡∏î',
                                  confirmButtonColor: '#A2E4B8',
                                  isDetails: true,
                                })}
                                className="text-blue-600 hover:text-white p-1 rounded-md bg-blue-100 hover:bg-blue-500 transition flex-shrink-0"
                                title="‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"
                              >
                                <IconInfo />
                              </button>
                            )}
                          </div>
                          {/* --- END EDIT --- */}
                          <div className="text-xs text-[#6C757D]">{item.Type}</div>
                        </td>

                        {/* 4. ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û" */}
                        <td className="px-4 py-4 whitespace-nowrap text-sm">
                          {/* --- START EDIT --- */}
                          {/* ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°
                            ‡πÇ‡∏î‡∏¢‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ field ImageX_ID ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ (truthy) ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                          */}
                          {(() => {
                            const hasImages = [item.Image1_ID, item.Image2_ID, item.Image3_ID, item.Image4_ID].some(id => id);
                            
                            return hasImages ? (
                              <button
                                onClick={() => toggleImages(item.RowID)}
                                className="text-left text-sm text-[#212529] hover:text-[#00796B] transition duration-150"
                              >
                                {/* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ */}
                                üñºÔ∏è {showImageMap[item.RowID] ? '‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û' : '‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û'}
                              </button>
                            ) : (
                              <span className="text-sm text-[#6C757D]">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</span>
                            );
                          })()}
                          {/* --- END EDIT --- */}
                        </td>
                        
                        {/* 5. ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "‡πÑ‡∏ü‡∏•‡πå/‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£" */}
                        <td className="px-4 py-4 whitespace-nowrap text-sm">
                          {/* Document Link Button */}
                          {item.DocumentFolderURL ? (
                            <a
                              href={item.DocumentFolderURL}
                              target="_blank"
                              rel="noopener noreferrer"
                              className="inline-flex items-center space-x-1 text-sm text-[#00796B] hover:underline"
                            >
                              <IconLink />
                              <span>‡∏î‡∏π‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</span>
                            </a>
                          ) : (
                            <span className="text-sm text-[#6C757D]">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</span>
                          )}
                        </td>
                        
                        {/* 6. ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£" / "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" */}
                        {/* --- START EDIT: Conditional Columns --- */}
                        {!isPublic && (
                          <td className="px-4 py-4 whitespace-nowrap text-sm font-medium">
                            <div className="flex space-x-2">
                              {/* REMOVED: View Details Button was here */}
                              
                              <button
                                onClick={() => onEdit(item)}
                                className="text-[#212529] hover:text-[#00796B] p-1 rounded-md bg-[#A2E4B8] bg-opacity-50 hover:bg-opacity-100 transition"
                                title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"
                              >
                                <IconEdit />
                              </button>
                              <button
                                onClick={() => onDelete(item.RowID)}
                                className="text-[#B22222] hover:text-white p-1 rounded-md bg-red-100 hover:bg-red-500 transition"
                                title="‡∏•‡∏ö"
                              >
                                <IconDelete />
                              </button>
                            </div>
                          </td>
                        )}
                        {isPublic && (
                          <td className="px-4 py-4 whitespace-nowrap text-sm text-center">
                            {/* --- START EDIT: Public "View Details" button --- */}
                            {/* This button now passes the entire 'item' object */}
                            <button
                              onClick={() => modal.show({
                                title: "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô", // New generic title
                                dataItem: item, // Pass the whole item
                                confirmButtonText: '‡∏õ‡∏¥‡∏î',
                                confirmButtonColor: '#A2E4B8',
                                isDetails: true,
                              })}
                              className="text-blue-600 hover:text-white p-1 rounded-md bg-blue-100 hover:bg-blue-500 transition flex-shrink-0"
                              title="‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"
                            >
                              <IconInfo />
                            </button>
                            {/* --- END EDIT --- */}
                          </td>
                        )}
                        {/* --- END EDIT --- */}
                      </tr>
                      {/* Collapsible Image Gallery Row */}
                      {showImageMap[item.RowID] && (
                        <tr className={index % 2 === 0 ? 'bg-white' : 'bg-[#F0FBF4]'}>
                          <td colSpan="6" className="p-0">
                            <ImageGallery
                              imageIds={[
                                item.Image1_ID,
                                item.Image2_ID,
                                item.Image3_ID,
                                item.Image4_ID,
                              ]}
                            />
                          </td>
                        </tr>
                      )}
                    </React.Fragment>
                  ))
                )}
              </tbody>
            </table>
          </div>
          
          {/* Pagination */}
          <Pagination
            currentPage={currentPage}
            totalPages={totalPages}
            onPageChange={setCurrentPage}
          />
        </div>
      );
    };

    /**
     * Admin Page Component
     */
    const AdminPage = () => {
      const [data, setData] = useState([]);
      const [isLoading, setIsLoading] = useState(true);
      const [error, setError] = useState(null);
      const [editingItem, setEditingItem] = useState(null); // null or item object
      const modal = useModal(); // Get modal context
      
      // Fetch data on mount
      const fetchData = useCallback(async () => {
        setIsLoading(true);
        setError(null);
        const result = await apiCall('read', {}, modal); // Pass modal // <-- CHANGED
        if (result.status === 'success') {
          setData(result.data);
        } else {
          // CHANGED: Improved error message handling
          let errorMsg = result.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ';
          if (errorMsg.includes('Invalid POST action')) {
            errorMsg = '‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (Invalid Action)';
          } else if (!result.message) {
            errorMsg = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ';
          }
          
          // ADDED: SHOW MODAL for server-side errors
          modal.show({
            icon: 'error',
            title: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
            text: errorMsg,
          });
          
          setError(errorMsg); // <-- Set error state for the table area
        }
        setIsLoading(false);
      }, [modal]); // Add modal to dependencies

      useEffect(() => {
        fetchData();
      }, [fetchData]);

      // Handle Form Submission (Create or Update)
      const handleFormSubmit = (submittedRow) => {
        // The form (DataForm) has already shown its success modal.
        // The 'submittedRow' parameter is the data returned from the API.
        // Instead of an optimistic update (which seems to be failing), 
        // we will re-fetch all data from the server to ensure consistency.
        
        fetchData(); // <-- CHANGED: Re-fetch all data from the server
        
        setEditingItem(null); // Close form/modal if in edit mode
      };

      // Handle Delete
      const handleDelete = (rowId) => {
        modal.confirm({
          title: '‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
          text: "‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ!",
          icon: 'warning',
          confirmButtonColor: '#B22222',
          confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡πÄ‡∏•‡∏¢!',
          cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
          onConfirm: async () => {
            modal.loading({
              title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...',
              allowOutsideClick: false,
            });

            const apiResult = await apiCall('delete', { rowId }, modal); // <-- CHANGED

            if (apiResult.status === 'success') {
              modal.show({
                icon: 'success',
                title: '‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 
                text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                timer: 2000,
                showConfirmButton: false
              });
              // Remove from state
              setData(prevData => prevData.filter(item => item.RowID !== rowId));
            } else {
              // CHANGED: Improved error message handling
              let errorMsg = apiResult.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ';
              if (errorMsg.includes('Invalid POST action')) {
                errorMsg = '‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (Invalid Action)';
              }
              
              modal.show({
                icon: 'error',
                title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 
                text: errorMsg // <-- CHANGED
              });
            }
          }
        });
      };
      
      // Handle Edit
      const handleEdit = (item) => {
        setEditingItem(item);
        // Scroll to top to show the form
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };
      
      const handleCancelEdit = () => {
        setEditingItem(null);
      };

      return (
        <div>
          <DataForm 
            key={editingItem ? editingItem.RowID : 'new'} // Reset form when editingItem changes
            onFormSubmit={handleFormSubmit}
            initialData={editingItem}
            onCancel={handleCancelEdit}
          />

          {isLoading ? (
            <div className="text-center py-10 text-[#6C757D]">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
          ) : error ? (
            <div className="text-center py-10 text-red-500">{error}</div>
          ) : (
            <DataTable
              data={data}
              onEdit={handleEdit}
              onDelete={handleDelete}
              modal={modal} // <-- ADDED
              isPublic={false} // <-- ADDED for clarity
            />
          )}
        </div>
      );
    };


    /**
     * Home Page Component
     */
    const HomePage = () => {
      // --- START EDIT: Add Data Fetching Logic (Copied from AdminPage) ---
      const [data, setData] = useState([]);
      const [isLoading, setIsLoading] = useState(true);
      const [error, setError] = useState(null);
      const modal = useModal(); // Get modal context
      
      // --- START EDIT: Add state for collapsible intro ---
      const [isIntroOpen, setIsIntroOpen] = useState(false);
      // --- END EDIT ---

      // --- START EDIT: Add memo for recent activities ---
      const recentActivities = useMemo(() => {
          return data
            .filter(item => item.Image1_ID) // Must have an image
            .sort((a, b) => new Date(b.DateStart) - new Date(a.DateStart)) // Newest first
            .slice(0, 8); // Max 8
      }, [data]);
      // --- END EDIT ---

      const fetchData = useCallback(async () => {
        setIsLoading(true);
        setError(null);
        const result = await apiCall('read', {}, modal); 
        if (result.status === 'success') {
          setData(result.data);
        } else {
          let errorMsg = result.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ';
          if (errorMsg.includes('Invalid POST action')) {
            errorMsg = '‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (Invalid Action)';
          } else if (!result.message) {
            errorMsg = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ';
          }
          
          // Don't show modal on public page load error, just set error text
          // modal.show({
          //   icon: 'error',
          //   title: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
          //   text: errorMsg,
          // });
          setError(errorMsg); 
        }
        setIsLoading(false);
      }, [modal]); 

      useEffect(() => {
        fetchData();
      }, [fetchData]);
      // --- END EDIT: Add Data Fetching Logic ---

      return (
        // --- START EDIT: Redesigned HomePage Header ---
        <>
          <div className="text-center py-10 px-4 bg-white rounded-lg shadow-lg">
            
            {/* 1. New Main Title (Gradient, "Expensive") */}
            {/* --- START EDIT: Adjust text, size, and line break --- */}
            <h1 className="text-xl md:text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-[#00796B] to-[#004D40] mb-6">
              EduLog (‡πÄ‡∏≠‡∏î‡∏π-‡∏•‡πá‡∏≠‡∏Å)
              <br /> {/* Force break on all screen sizes */}
              ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡∏£‡πà‡∏≠‡∏á‡∏£‡∏≠‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ ‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤
            </h1>
            {/* --- END EDIT --- */}
            
            {/* 2. Author/School Info */}
            <div className="mt-6 border-t border-[#E9ECEF] pt-6 max-w-3xl mx-auto">
              <p className="text-lg font-medium text-[#212529]">
                ‡∏ô‡∏≤‡∏¢‡∏û‡∏¥‡∏ó‡∏±‡∏Å‡∏©‡πå‡∏ä‡∏±‡∏¢ ‡∏ú‡∏≤‡∏¢‡∏ö‡∏∂‡∏á‡πÅ‡∏Å‡πâ‡∏ß ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ
              </p>
              <p className="text-lg font-medium text-[#00796B] mt-1">
                ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ
              </p>
            </div>

            {/* 3. New Introduction Paragraph ("‡∏Ñ‡∏≥‡∏ô‡∏≥") */}
            {/* --- START EDIT: Make introduction collapsible --- */}
            <div className="mt-8 max-w-3xl mx-auto text-left">
              
              {/* Toggle Button */}
              <button
                onClick={() => setIsIntroOpen(!isIntroOpen)}
                className="flex items-center space-x-2 text-sm font-medium text-[#00796B] hover:text-[#004D40] transition duration-150"
              >
                <span>{isIntroOpen ? '‡∏ã‡πà‡∏≠‡∏ô‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢' : '‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö'}</span>
                <span className={`transform transition-transform duration-300 ${isIntroOpen ? 'rotate-180' : 'rotate-0'}`}>
                  <IconChevronDown />
                </span>
              </button>

              {/* Collapsible Content */}
              <div 
                className={`
                  grid transition-all duration-500 ease-in-out
                  ${isIntroOpen ? 'grid-rows-[1fr] opacity-100' : 'grid-rows-[0fr] opacity-0'}
                `}
              >
                <div className="overflow-hidden"> {/* Grid trick wrapper */}
                  <div className="pt-4"> {/* Padding top for spacing from button */}
                    <p className="text-base text-gray-700 leading-relaxed indent-8">
                      ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà EduLog ("‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å" (Log) ‡∏î‡πâ‡∏≤‡∏ô "‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤" (Edu) ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö) ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏à‡∏∏‡∏î‡∏°‡∏∏‡πà‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏° ‡∏ï‡∏•‡∏≠‡∏î‡∏à‡∏ô‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ô‡∏ô‡πà‡∏≤‡∏†‡∏≤‡∏Ñ‡∏†‡∏π‡∏°‡∏¥‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏£‡∏π‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
                    </p>
                    <p className="mt-4 text-base text-gray-700 leading-relaxed indent-8">
                      EduLog ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•' (Digital Log) ‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡∏≠‡∏á‡∏Ñ‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡πÄ‡∏ä‡∏¥‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏±‡∏Å‡∏©‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏• ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏´‡πà‡∏á‡πÅ‡∏£‡∏á‡∏ö‡∏±‡∏ô‡∏î‡∏≤‡∏•‡πÉ‡∏à‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï ‡∏Ç‡∏≠‡πÄ‡∏ä‡∏¥‡∏ç‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏™‡∏ô‡πÉ‡∏à‡∏ó‡∏∏‡∏Å‡∏ó‡πà‡∏≤‡∏ô ‡∏£‡πà‡∏ß‡∏°‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏ú‡∏•‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ ‡∏ì ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ
                    </p>
                  </div>
                </div>
              </div>

            </div>
            {/* --- END EDIT --- */}
            
          </div>
          
          {/* --- START EDIT: Add Dashboard Section --- */}
          {!isLoading && !error && recentActivities.length > 0 && (
            <RecentActivityDashboard items={recentActivities} modal={modal} />
          )}
          {/* --- END EDIT --- */}

          {/* Public Data Table */}
          {isLoading ? (
            <div className="text-center py-10 text-[#6C757D]">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
          ) : error ? (
            <div className="text-center py-10 text-red-500">{error}</div>
          ) : (
            <DataTable
              data={data}
              onEdit={() => {}} // No edit on public page
              onDelete={() => {}} // No delete on public page
              modal={modal}
              isPublic={true} // <-- ADDED: This hides admin buttons
            />
          )}
        </>
        // --- END EDIT: Redesigned HomePage Header ---
      );
    };


    /**
     * Main App Component
     */
    // ---!!!---
    // ‡∏•‡∏ö 'export default' ‡∏≠‡∏≠‡∏Å
    function App() {
    // ---!!!---
      const [page, setPage] = useState('home'); // 'home', 'login', 'admin'
      const [isAuthenticated, setIsAuthenticated] = useState(false);

      const handleNavigation = (targetPage) => {
        if (targetPage === 'home') {
          setIsAuthenticated(false);
          setPage('home');
        } else if (targetPage === 'login') {
          setPage('login');
        }
      };

      const handleLoginSuccess = () => {
        setIsAuthenticated(true);
        setPage('admin');
      };
      
      let content;
      if (page === 'admin' && isAuthenticated) {
        content = <AdminPage />;
      } else if (page === 'login') {
        content = <LoginPage onLoginSuccess={handleLoginSuccess} />;
      } else {
        content = <HomePage />;
      }

      return (
        <ModalProvider> {/* Wrap the entire app in ModalProvider */}
          <div className="min-h-screen bg-[#F8F9FA] font-['Noto_Sans_Thai_Looped',_sans-serif]">
            <Header page={page} onNav={handleNavigation} />
            <main className="container mx-auto px-4 py-6">
              {content}
            </main>
            <Footer />
          </div>
        </ModalProvider>
      );
    }
    
    // --- End: ‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏≤‡∏Å app.jsx ---


    // --- 8. (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç) ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Render React App ---
    
    // ‡∏´‡∏≤ <div id="root">
    const container = document.getElementById('root');
    
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á React root
    const root = ReactDOM.createRoot(container);
    
    // Render Component <App />
    root.render(<App />);
    
  </script>
  <!-- End React App Script -->
  
</body>
</html>






